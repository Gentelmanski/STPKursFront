<div class="user-dashboard-container">
      <!-- Верхняя панель -->
      <mat-toolbar color="primary" class="user-toolbar">
        <div class="toolbar-left">
          <button mat-icon-button (click)="goToMap()" matTooltip="На карту">
            <mat-icon>map</mat-icon>
          </button>
          <span class="dashboard-title">Личный кабинет</span>
        </div>
        
        <span class="spacer"></span>
        
        <div class="user-info">
          <mat-chip color="accent" selected>
            <mat-icon class="chip-icon">person</mat-icon>
            {{authService.getCurrentUser()?.role === 'admin' ? 'АДМИН' : 'ПОЛЬЗОВАТЕЛЬ'}}
          </mat-chip>
          <span class="username">{{authService.getCurrentUser()?.username}}</span>
          <button mat-icon-button [matMenuTriggerFor]="userMenu">
            <mat-icon>account_circle</mat-icon>
          </button>
          <mat-menu #userMenu="matMenu">
            <button mat-menu-item (click)="goToProfile()">
              <mat-icon>person</mat-icon>
              <span>Мой профиль</span>
            </button>
            <button mat-menu-item (click)="goToMap()">
              <mat-icon>map</mat-icon>
              <span>Карта мероприятий</span>
            </button>
            <button mat-menu-item *ngIf="authService.hasRole('admin')" (click)="goToAdmin()">
              <mat-icon>admin_panel_settings</mat-icon>
              <span>Админ панель</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="logout()">
              <mat-icon>logout</mat-icon>
              <span>Выйти</span>
            </button>
          </mat-menu>
        </div>
      </mat-toolbar>

      <!-- Основное содержимое -->
      <div class="dashboard-content">
        <!-- Статистика пользователя -->
        <div class="user-stats-section">
          <mat-card class="stats-card">
            <mat-card-header>
              <mat-card-title>Ваша активность</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stats-grid">
                <div class="stat-item" (click)="goToCreatedEvents()">
                  <mat-icon class="stat-icon">event</mat-icon>
                  <div class="stat-content">
                    <div class="stat-value">{{stats?.created_events || 0}}</div>
                    <div class="stat-label">Созданных мероприятий</div>
                  </div>
                </div>
                <div class="stat-item" (click)="goToParticipatingEvents()">
                  <mat-icon class="stat-icon">group</mat-icon>
                  <div class="stat-content">
                    <div class="stat-value">{{stats?.participated_events || 0}}</div>
                    <div class="stat-label">Буду участвовать</div>
                  </div>
                </div>
                <div class="stat-item">
                  <mat-icon class="stat-icon">comment</mat-icon>
                  <div class="stat-content">
                    <div class="stat-value">{{stats?.comments || 0}}</div>
                    <div class="stat-label">Комментариев</div>
                  </div>
                </div>
                <div class="stat-item">
                  <mat-icon class="stat-icon">stars</mat-icon>
                  <div class="stat-content">
                    <div class="stat-value">{{stats?.rating || 0}}</div>
                    <div class="stat-label">Рейтинг</div>
                  </div>
                </div>
              </div>
            </mat-card-content>
            <mat-card-actions>
              <button mat-raised-button color="primary" (click)="openCreateEventDialog()">
                <mat-icon>add</mat-icon>
                Создать мероприятие
              </button>
            </mat-card-actions>
          </mat-card>
        </div>

        <!-- Вкладки -->
        <mat-tab-group class="user-tabs" animationDuration="0ms" [(selectedIndex)]="selectedTab">
          <!-- Мои мероприятия -->
          <mat-tab label="Мои мероприятия">
            <ng-template matTabContent>
              <div class="tab-content">
                <div class="tab-header">
                  <h2>Созданные мной мероприятия</h2>
                  <div class="tab-actions">
                    <mat-form-field appearance="outline" class="search-field">
                      <mat-label>Поиск мероприятий</mat-label>
                      <input matInput [formControl]="myEventsSearchControl" placeholder="Поиск по названию...">
                      <mat-icon matSuffix>search</mat-icon>
                    </mat-form-field>
                  </div>
                </div>
                
                <mat-card>
                  <div class="table-container">
                    <table mat-table [dataSource]="myEventsDataSource" matSort class="user-table">
                      
                      <!-- Название Column -->
                      <ng-container matColumnDef="title">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Название</th>
                        <td mat-cell *matCellDef="let event">
                          <div class="event-title">
                            {{event.title}}
                            <span class="event-type">{{getEventTypeText(event.type)}}</span>
                          </div>
                          <div class="event-description" *ngIf="event.description">
                            {{event.description | slice:0:100}}{{event.description.length > 100 ? '...' : ''}}
                          </div>
                        </td>
                      </ng-container>
                      
                      <!-- Дата Column -->
                      <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата</th>
                        <td mat-cell *matCellDef="let event">
                          <div class="event-date">
                            {{formatDate(event.event_date)}}
                            <div class="event-status" [class]="getEventStatus(event)">
                              {{getEventStatusText(event)}}
                            </div>
                          </div>
                        </td>
                      </ng-container>
                      
                      <!-- Участники Column -->
                      <ng-container matColumnDef="participants">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Участники</th>
                        <td mat-cell *matCellDef="let event">
                          <div class="participants-info">
                            <span class="participants-count">{{event.participants_count || 0}}</span>
                            <span *ngIf="event.max_participants" class="max-participants">
                              / {{event.max_participants}}
                            </span>
                            <mat-progress-bar 
                              *ngIf="event.max_participants"
                              mode="determinate" 
                              [value]="(event.participants_count / event.max_participants) * 100"
                              class="participants-progress">
                            </mat-progress-bar>
                          </div>
                        </td>
                      </ng-container>
                      
                      <!-- Статус верификации Column -->
                      <ng-container matColumnDef="verification">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Статус</th>
                        <td mat-cell *matCellDef="let event">
                          <mat-chip [color]="getVerificationColor(event)" selected>
                            {{getVerificationText(event)}}
                          </mat-chip>
                        </td>
                      </ng-container>
                      
                      <!-- Действия Column -->
                      <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Действия</th>
                        <td mat-cell *matCellDef="let event">
                          <div class="action-buttons">
                            <button mat-icon-button color="primary" 
                                    (click)="viewEvent(event.id)"
                                    matTooltip="Просмотреть">
                              <mat-icon>visibility</mat-icon>
                            </button>
                            <button mat-icon-button color="primary" 
                                    (click)="editEvent(event)"
                                    [disabled]="!canEditEvent(event)"
                                    matTooltip="Редактировать">
                              <mat-icon>edit</mat-icon>
                            </button>
                            <button mat-icon-button color="warn" 
                                    (click)="deleteEvent(event)"
                                    [disabled]="!canDeleteEvent(event)"
                                    matTooltip="Удалить">
                              <mat-icon>delete</mat-icon>
                            </button>
                            <button mat-icon-button 
                                    color="accent"
                                    (click)="toggleEventStatus(event)"
                                    [disabled]="!canToggleEvent(event)"
                                    matTooltip="Активировать/Деактивировать">
                              <mat-icon>{{event.is_active ? 'toggle_on' : 'toggle_off'}}</mat-icon>
                            </button>
                          </div>
                        </td>
                      </ng-container>
                      
                      <tr mat-header-row *matHeaderRowDef="myEventsDisplayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: myEventsDisplayedColumns;"></tr>
                      
                      <!-- Сообщение о пустой таблице -->
                      <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="5">
                          <div class="no-data-message">
                            <mat-icon>event_busy</mat-icon>
                            <p>Вы еще не создали ни одного мероприятия</p>
                            <button mat-raised-button color="primary" (click)="openCreateEventDialog()">
                              Создать первое мероприятие
                            </button>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>
                  
                  <mat-paginator [pageSizeOptions]="[5, 10, 25]" 
                                showFirstLastButtons
                                aria-label="Select page of events">
                  </mat-paginator>
                </mat-card>
              </div>
            </ng-template>
          </mat-tab>
          
          <!-- Мероприятия, на которые я записан -->
          <mat-tab label="Я участвую">
            <ng-template matTabContent>
              <div class="tab-content">
                <div class="tab-header">
                  <h2>Мероприятия, на которые я записан</h2>
                  <div class="tab-actions">
                    <mat-form-field appearance="outline" class="search-field">
                      <mat-label>Фильтр по статусу</mat-label>
                      <mat-select [formControl]="participationFilterControl">
                        <mat-option value="all">Все</mat-option>
                        <mat-option value="upcoming">Предстоящие</mat-option>
                        <mat-option value="ongoing">Идущие сейчас</mat-option>
                        <mat-option value="past">Прошедшие</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                
                <mat-card>
                  <div class="table-container">
                    <table mat-table [dataSource]="participatedEventsDataSource" matSort class="user-table">
                      
                      <!-- Название Column -->
                      <ng-container matColumnDef="title">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Название</th>
                        <td mat-cell *matCellDef="let participation">
                          <div class="event-title">
                            {{participation.event?.title || participation.title}}
                            <span class="event-type">{{getEventTypeText(participation.event?.type || participation.type)}}</span>
                          </div>
                          <div class="event-creator" *ngIf="participation.event?.creator">
                            Организатор: {{participation.event.creator.username}}
                          </div>
                          <div class="event-creator" *ngIf="!participation.event?.creator && participation.creator_username">
                            Организатор: {{participation.creator_username}}
                          </div>
                        </td>
                      </ng-container>
                      
                      <!-- Дата Column -->
                      <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата</th>
                        <td mat-cell *matCellDef="let participation">
                          <div class="event-date">
                            {{formatDate(participation.event?.event_date || participation.event_date)}}
                            <div class="event-status" [class]="getEventStatus(participation.event || participation)">
                              {{getEventStatusText(participation.event || participation)}}
                            </div>
                          </div>
                        </td>
                      </ng-container>
                      
                      <!-- Статус участия Column -->
                      <ng-container matColumnDef="participation_status">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Мой статус</th>
                        <td mat-cell *matCellDef="let participation">
                          <mat-chip [color]="getParticipationStatusColor(participation.status)" selected>
                            {{getParticipationStatusText(participation.status)}}
                          </mat-chip>
                        </td>
                      </ng-container>
                      
                      <!-- Записался Column -->
                      <ng-container matColumnDef="joined_at">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Записался</th>
                        <td mat-cell *matCellDef="let participation">
                          {{formatDate(participation.joined_at)}}
                        </td>
                      </ng-container>
                      
                      <!-- Действия Column -->
                      <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Действия</th>
                        <td mat-cell *matCellDef="let participation">
                          <div class="action-buttons">
                            <button mat-icon-button color="primary" 
                                    (click)="viewEvent(participation.event?.id || participation.id)"
                                    matTooltip="Просмотреть">
                              <mat-icon>visibility</mat-icon>
                            </button>
                            <button mat-icon-button 
                                    color="primary"
                                    (click)="changeParticipationStatus(participation)"
                                    matTooltip="Изменить статус участия">
                              <mat-icon>swap_horiz</mat-icon>
                            </button>
                            <button mat-icon-button color="warn" 
                                    (click)="cancelParticipation(participation)"
                                    [disabled]="!canCancelParticipation(participation)"
                                    matTooltip="Отменить участие">
                              <mat-icon>cancel</mat-icon>
                            </button>
                          </div>
                        </td>
                      </ng-container>
                      
                      <tr mat-header-row *matHeaderRowDef="participatedEventsDisplayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: participatedEventsDisplayedColumns;"></tr>
                      
                      <!-- Сообщение о пустой таблице -->
                      <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="5">
                          <div class="no-data-message">
                            <mat-icon>group_off</mat-icon>
                            <p>Вы еще не записались ни на одно мероприятие</p>
                            <button mat-raised-button color="primary" (click)="goToMap()">
                              Найти мероприятия на карте
                            </button>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>
                  
                  <mat-paginator [pageSizeOptions]="[5, 10, 25]" 
                                showFirstLastButtons
                                aria-label="Select page of events">
                  </mat-paginator>
                </mat-card>
              </div>
            </ng-template>
          </mat-tab>
          
          <!-- Профиль -->
          <mat-tab label="Профиль">
            <ng-template matTabContent>
              <div class="tab-content">
                <mat-card class="profile-card">
                  <mat-card-header>
                    <mat-card-title>Информация о профиле</mat-card-title>
                  </mat-card-header>
                  <mat-card-content>
                    <div class="profile-info-grid">
                      <div class="profile-item">
                        <span class="profile-label">ID пользователя:</span>
                        <span class="profile-value">{{authService.getCurrentUser()?.id}}</span>
                      </div>
                      <div class="profile-item">
                        <span class="profile-label">Имя пользователя:</span>
                        <span class="profile-value">{{authService.getCurrentUser()?.username}}</span>
                      </div>
                      <div class="profile-item">
                        <span class="profile-label">Email:</span>
                        <span class="profile-value">{{authService.getCurrentUser()?.email}}</span>
                      </div>
                      <div class="profile-item">
                        <span class="profile-label">Роль:</span>
                        <span class="profile-value">
                          <mat-chip [color]="authService.getCurrentUser()?.role === 'admin' ? 'warn' : 'primary'" selected>
                            {{authService.getCurrentUser()?.role === 'admin' ? 'Администратор' : 'Пользователь'}}
                          </mat-chip>
                        </span>
                      </div>
                      <div class="profile-item">
                        <span class="profile-label">Дата регистрации:</span>
                        <span class="profile-value">{{formatDate(authService.getCurrentUser()?.created_at)}}</span>
                      </div>
                      <div class="profile-item">
                        <span class="profile-label">Последний онлайн:</span>
                        <span class="profile-value">{{formatDate(authService.getCurrentUser()?.last_online)}}</span>
                      </div>
                    </div>
                    
                    <mat-divider></mat-divider>
                    
                    <div class="profile-actions">
                      <button mat-raised-button color="primary" (click)="editProfile()">
                        <mat-icon>edit</mat-icon>
                        Редактировать профиль
                      </button>
                      <button mat-raised-button color="accent" (click)="changePassword()">
                        <mat-icon>lock</mat-icon>
                        Сменить пароль
                      </button>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </ng-template>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>