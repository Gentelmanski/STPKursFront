<div class="event-details-container">
      <!-- Заголовок -->
      <div mat-dialog-title class="dialog-header">
        <h2>{{event?.title || 'Загрузка...'}}</h2>
        <button mat-icon-button (click)="onClose()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-divider></mat-divider>

      <!-- Контент -->
      <div mat-dialog-content class="dialog-content">
        <!-- Загрузка -->
        <div *ngIf="isLoading" class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Загрузка информации о мероприятии...</p>
        </div>

        <!-- Основная информация -->
        <div *ngIf="!isLoading && event" class="content">
          <!-- Статус мероприятия -->
          <div class="status-section">
            <mat-chip [color]="getEventStatusColor()" selected class="status-chip">
              <mat-icon>{{getEventStatusIcon()}}</mat-icon>
              {{getEventStatusText()}}
            </mat-chip>
            
            <span class="event-type">{{getEventTypeText()}}</span>
            
            <div *ngIf="!event?.is_verified" class="verification-status">
              <mat-icon class="warning-icon">warning</mat-icon>
              <span>На верификации администратора</span>
            </div>
          </div>

          <!-- Основная информация -->
          <div class="main-info">
            <div class="info-row">
              <mat-icon>event</mat-icon>
              <div class="info-content">
                <strong>Дата и время:</strong>
                <span>{{formatDate(event?.event_date)}}</span>
                <small [class]="getTimeRemainingClass()">
                  {{getTimeRemaining()}}
                </small>
              </div>
            </div>

            <div class="info-row">
              <mat-icon>location_on</mat-icon>
              <div class="info-content">
                <strong>Местоположение:</strong>
                <span>{{event?.address || 'Адрес не указан'}}</span>
                <small *ngIf="event?.latitude && event?.longitude">
                  Координаты: {{event.latitude.toFixed(4)}}, {{event.longitude.toFixed(4)}}
                </small>
              </div>
            </div>

            <div class="info-row" *ngIf="event?.price !== undefined">
              <mat-icon>attach_money</mat-icon>
              <div class="info-content">
                <strong>Стоимость:</strong>
                <span>{{event?.price > 0 ? event.price + ' ₽' : 'Бесплатно'}}</span>
              </div>
            </div>

            <div class="info-row" *ngIf="event?.duration">
              <mat-icon>schedule</mat-icon>
              <div class="info-content">
                <strong>Продолжительность:</strong>
                <span>{{event.duration}} минут</span>
              </div>
            </div>
          </div>

          <!-- Участники -->
          <mat-card class="participants-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>group</mat-icon>
                Участники
                <span class="participants-count">
                  {{event?.participants_count || 0}}
                  <span *ngIf="event?.max_participants">/{{event.max_participants}}</span>
                </span>
              </mat-card-title>
            </mat-card-header>

            <mat-card-content>
              <mat-progress-bar 
                *ngIf="event?.max_participants"
                mode="determinate" 
                [value]="getParticipantsPercentage()"
                [color]="getParticipantsColor()"
                class="participants-progress">
              </mat-progress-bar>

              <div class="participants-status">
                <div *ngIf="isEventFull()" class="event-full-warning">
                  <mat-icon>info</mat-icon>
                  <span>Мероприятие заполнено</span>
                </div>
                <div *ngIf="isEventCreator()" class="creator-badge">
                  <mat-icon>star</mat-icon>
                  <span>Вы организатор</span>
                </div>
                <div *ngIf="isParticipating()" class="participating-badge">
                  <mat-icon>check_circle</mat-icon>
                  <span>Вы участник</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Описание -->
          <mat-expansion-panel class="description-panel" [expanded]="true">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>description</mat-icon>
                Описание мероприятия
              </mat-panel-title>
            </mat-expansion-panel-header>
            
            <div class="description-content">
              <p *ngIf="event?.description; else noDescription">
                {{event.description}}
              </p>
              <ng-template #noDescription>
                <p class="no-description">Описание отсутствует</p>
              </ng-template>
            </div>
          </mat-expansion-panel>

          <!-- Информация о создателе -->
          <mat-card class="creator-card" *ngIf="event?.creator">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>person</mat-icon>
                Организатор
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="creator-info">
                <div class="creator-avatar">
                  <mat-icon>account_circle</mat-icon>
                </div>
                <div class="creator-details">
                  <h4>{{event.creator.username}}</h4>
                  <p>{{event.creator.email}}</p>
                  <small>Создано: {{formatDate(event.created_at)}}</small>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Ошибка загрузки -->
        <div *ngIf="!isLoading && !event && loadError" class="error-container">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <h3>Не удалось загрузить информацию</h3>
          <p>{{loadError}}</p>
          <button mat-raised-button color="primary" (click)="retryLoad()">
            <mat-icon>refresh</mat-icon>
            Повторить попытку
          </button>
        </div>
      </div>

      <mat-divider *ngIf="!isLoading && event"></mat-divider>

      <!-- Действия -->
      <div mat-dialog-actions class="dialog-actions" *ngIf="!isLoading && event">
        <div class="action-buttons">
          <!-- Кнопка закрытия -->
          <button mat-button (click)="onClose()">
            Закрыть
          </button>

          <div class="event-actions">
            <!-- Кнопка показа на карте -->
            <!-- <button mat-icon-button color="primary" 
                    (click)="viewEventOnMap()"
                    matTooltip="Показать на карте"
                    class="map-btn">
              <mat-icon>place</mat-icon>
            </button> -->
            
            <!-- Кнопки для не-создателя -->
            <ng-container *ngIf="!isEventCreator()">
              <button mat-raised-button 
                      color="primary"
                      *ngIf="!isParticipating()"
                      (click)="participate()"
                      [disabled]="isEventFull() || !event?.is_verified || actionLoading"
                      matTooltip="Записаться на мероприятие"
                      class="participate-btn">
                <mat-icon>person_add</mat-icon>
                Записаться
              </button>
              
              <button mat-raised-button 
                      color="warn"
                      *ngIf="isParticipating()"
                      (click)="cancelParticipation()"
                      [disabled]="actionLoading"
                      matTooltip="Отказаться от участия"
                      class="cancel-btn">
                <mat-icon>person_remove</mat-icon>
                Отказаться от участия
              </button>
            </ng-container>

            <!-- Для создателя
            <ng-container *ngIf="isEventCreator()">
              <button mat-raised-button color="accent" 
                      (click)="editEvent()"
                      matTooltip="Редактировать мероприятие"
                      class="edit-btn">
                <mat-icon>edit</mat-icon>
                Редактировать
              </button>
            </ng-container> -->
          </div>
        </div>
      </div>

      <!-- Индикатор загрузки действия -->
      <div *ngIf="actionLoading" class="action-loading">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
    </div>