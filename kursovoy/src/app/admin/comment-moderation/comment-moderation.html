<div class="comment-moderation">
      <div class="header">
        <h2>Модерация комментариев</h2>
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Поиск комментариев</mat-label>
          <input matInput [formControl]="searchControl" placeholder="Поиск по содержанию или автору...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
      
      <mat-card>
        <div class="table-container">
          <table mat-table [dataSource]="dataSource" matSort class="comment-table">
            
            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
              <td mat-cell *matCellDef="let comment">{{comment.id}}</td>
            </ng-container>
            
            <!-- Содержание Column -->
            <ng-container matColumnDef="content">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Содержание</th>
              <td mat-cell *matCellDef="let comment">
                <div class="comment-content">
                  {{comment.content | slice:0:100}}{{comment.content.length > 100 ? '...' : ''}}
                  <div class="comment-meta">
                    <span class="event-info">
                      <mat-icon>event</mat-icon>
                      {{comment.event_title || 'Мероприятие #' + comment.event_id}}
                    </span>
                  </div>
                </div>
              </td>
            </ng-container>
            
            <!-- Автор Column -->
            <ng-container matColumnDef="author">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Автор</th>
              <td mat-cell *matCellDef="let comment">
                <div class="author-info">
                  <div>{{comment.user?.username || 'Аноним'}}</div>
                  <div class="author-email">{{comment.user?.email || ''}}</div>
                </div>
              </td>
            </ng-container>
            
            <!-- Дата Column -->
            <ng-container matColumnDef="created_at">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата</th>
              <td mat-cell *matCellDef="let comment">{{formatDate(comment.created_at)}}</td>
            </ng-container>
            
            <!-- Рейтинг Column -->
            <ng-container matColumnDef="score">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Рейтинг</th>
              <td mat-cell *matCellDef="let comment">
                <mat-chip [color]="comment.score > 0 ? 'primary' : comment.score < 0 ? 'warn' : ''">
                  {{comment.score}}
                </mat-chip>
              </td>
            </ng-container>
            
            <!-- Статус Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Статус</th>
              <td mat-cell *matCellDef="let comment">
                <mat-chip [color]="comment.is_deleted ? 'warn' : 'accent'" selected>
                  {{comment.is_deleted ? 'Удален' : 'Активен'}}
                </mat-chip>
              </td>
            </ng-container>
            
            <!-- Действия Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Действия</th>
              <td mat-cell *matCellDef="let comment">
                <div class="action-buttons">
                  <button mat-icon-button color="primary" 
                          (click)="viewCommentDetails(comment)"
                          matTooltip="Просмотреть">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" 
                          (click)="deleteComment(comment)"
                          *ngIf="!comment.is_deleted"
                          matTooltip="Удалить">
                    <mat-icon>delete</mat-icon>
                  </button>
                  <button mat-icon-button color="primary" 
                          (click)="restoreComment(comment)"
                          *ngIf="comment.is_deleted"
                          matTooltip="Восстановить">
                    <mat-icon>restore</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            
            <!-- Сообщение о пустой таблице -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="7">
                <div class="no-data-message">
                  <mat-icon>comment</mat-icon>
                  <p>Нет комментариев для модерации</p>
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" 
                      showFirstLastButtons
                      aria-label="Select page of comments">
        </mat-paginator>
      </mat-card>
    </div>