<div *ngIf="action === 'view' || action === 'viewUser' || action === 'viewComment'; else verificationTemplate">
      <!-- Детальный просмотр мероприятия или пользователя -->
      <h2 mat-dialog-title>
        {{getDialogTitle()}}
      </h2>
      <mat-dialog-content>
        <div *ngIf="action === 'view' && event">
          <mat-card>
            <mat-card-header>
              <mat-card-title>{{event.title}}</mat-card-title>
              <mat-card-subtitle>{{getEventTypeText(event.type)}}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="detail-section">
                <h4>Описание:</h4>
                <p>{{event.description}}</p>
              </div>
              
              <mat-divider></mat-divider>
              
              <div class="details-grid">
                <div class="detail-item">
                  <span class="detail-label">Дата мероприятия:</span>
                  <span class="detail-value">{{formatDate(event.event_date)}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Создатель:</span>
                  <span class="detail-value">{{event.creator?.username || 'Неизвестно'}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Email создателя:</span>
                  <span class="detail-value">{{event.creator?.email || 'Неизвестно'}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Участников:</span>
                  <span class="detail-value">{{event.participants_count || 0}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Цена:</span>
                  <span class="detail-value">{{event.price > 0 ? (event.price + ' ₽') : 'Бесплатно'}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Статус:</span>
                  <span class="detail-value">
                    <mat-chip [color]="getStatusColor(event)" selected>
                      {{getStatusText(event)}}
                    </mat-chip>
                  </span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Создано:</span>
                  <span class="detail-value">{{formatDate(event.created_at)}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Обновлено:</span>
                  <span class="detail-value">{{formatDate(event.updated_at)}}</span>
                </div>
              </div>
              
              <div *ngIf="event.tags && event.tags.length > 0" class="tags-section">
                <mat-divider></mat-divider>
                <h4>Теги:</h4>
                <div class="tags-container">
                  <mat-chip *ngFor="let tag of event.tags" color="primary">
                    {{tag}}
                  </mat-chip>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
        
        <div *ngIf="action === 'viewUser' && user">
          <mat-card>
            <mat-card-header>
              <mat-card-title>{{user.username}}</mat-card-title>
              <mat-card-subtitle>{{user.email}}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="details-grid">
                <div class="detail-item">
                  <span class="detail-label">ID:</span>
                  <span class="detail-value">{{user.id}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Роль:</span>
                  <span class="detail-value">
                    <mat-chip [color]="user.role === 'admin' ? 'warn' : 'primary'" selected>
                      {{user.role === 'admin' ? 'Администратор' : 'Пользователь'}}
                    </mat-chip>
                  </span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Статус:</span>
                  <span class="detail-value">
                    <mat-chip [color]="user.is_blocked ? 'warn' : 'accent'" selected>
                      {{user.is_blocked ? 'Заблокирован' : 'Активен'}}
                    </mat-chip>
                  </span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Дата регистрации:</span>
                  <span class="detail-value">{{formatDate(user.created_at)}}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Последний онлайн:</span>
                  <span class="detail-value">{{formatDate(user.last_online)}}</span>
                </div>
              </div>
              
              <mat-divider></mat-divider>
              
              <div class="user-stats">
                <h4>Статистика активности:</h4>
                <div class="stats-grid">
                  <div class="stat-item">
                    <mat-icon>event</mat-icon>
                    <div class="stat-content">
                      <div class="stat-value">{{user.events_created || 0}}</div>
                      <div class="stat-label">Созданных мероприятий</div>
                    </div>
                  </div>
                  <div class="stat-item">
                    <mat-icon>group</mat-icon>
                    <div class="stat-content">
                      <div class="stat-value">{{user.events_participated || 0}}</div>
                      <div class="stat-label">Участий в мероприятиях</div>
                    </div>
                  </div>
                  <div class="stat-item">
                    <mat-icon>comment</mat-icon>
                    <div class="stat-content">
                      <div class="stat-value">{{user.comments_count || 0}}</div>
                      <div class="stat-label">Комментариев</div>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-dialog-content>
      <mat-dialog-actions align="end">
        <button mat-button mat-dialog-close>Закрыть</button>
      </mat-dialog-actions>
    </div>
    
    <ng-template #verificationTemplate>
      <!-- Диалог верификации/отклонения/удаления -->
      <h2 mat-dialog-title>
        {{getDialogTitle()}}
      </h2>
      <mat-dialog-content>
        <p>{{data.message}}</p>
        
        <form *ngIf="action === 'reject'" [formGroup]="rejectForm">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Причина отклонения</mat-label>
            <textarea matInput formControlName="reason" rows="4" required></textarea>
            <mat-error *ngIf="rejectForm.get('reason')?.hasError('required')">
              Укажите причину отклонения
            </mat-error>
          </mat-form-field>
        </form>
      </mat-dialog-content>
      <mat-dialog-actions align="end">
        <button mat-button (click)="onCancel()">Отмена</button>
        <button mat-raised-button 
                [color]="action === 'verify' ? 'primary' : 'warn'"
                (click)="onConfirm()"
                [disabled]="action === 'reject' && !rejectForm.valid">
          {{getConfirmButtonText()}}
        </button>
      </mat-dialog-actions>
    </ng-template>