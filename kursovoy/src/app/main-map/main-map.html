<div class="main-container">
      <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
      <mat-toolbar color="primary" class="toolbar">
        <span class="logo">–ú–∞—è–∫</span>
        
        <span class="spacer"></span>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
        <button mat-icon-button [matMenuTriggerFor]="notificationsMenu" class="notification-btn">
          <mat-icon [matBadge]="unreadNotifications" matBadgeColor="warn">notifications</mat-icon>
        </button>
        <mat-menu #notificationsMenu="matMenu">
          <div class="notifications-header">
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            <button mat-icon-button (click)="markAllAsRead()">
              <mat-icon>done_all</mat-icon>
            </button>
          </div>
          <mat-divider></mat-divider>
          <div *ngIf="notifications.length === 0" class="no-notifications">
            <mat-icon>notifications_off</mat-icon>
            <p>–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
          </div>
          <div *ngFor="let notification of notifications" 
               class="notification-item"
               [class.unread]="!notification.read">
            <mat-icon>{{getNotificationIcon(notification.type)}}</mat-icon>
            <div class="notification-content">
              <p>{{notification.message}}</p>
              <small>{{notification.created_at | date:'short'}}</small>
            </div>
          </div>
        </mat-menu>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è —Ç–∞–±–ª–∏—Ü—ã -->
        <button mat-icon-button (click)="toggleEventsTable()" matTooltip="–°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π">
          <mat-icon>{{showEventsTable ? 'list' : 'list_alt'}}</mat-icon>
        </button>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
        <button mat-raised-button color="accent" (click)="openCreateEventDialog()">
          <mat-icon>add</mat-icon>
          –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
        </button>
        
        <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <button mat-icon-button [matMenuTriggerFor]="profileMenu">
          <mat-icon>account_circle</mat-icon>
        </button>
        <mat-menu #profileMenu="matMenu">
          <div class="profile-info">
            <h4>{{authService.getCurrentUser()?.username}}</h4>
            <p>{{authService.getCurrentUser()?.email}}</p>
            <mat-chip *ngIf="authService.hasRole('admin')" color="warn" selected>
              <mat-icon>security</mat-icon> –ê–¥–º–∏–Ω
            </mat-chip>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="goToProfile()">
            <mat-icon>person</mat-icon>
            <span>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
          </button>
          <button mat-menu-item *ngIf="authService.hasRole('admin')" (click)="goToAdmin()">
            <mat-icon>admin_panel_settings</mat-icon>
            <span>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
          </button>
          <button mat-menu-item (click)="logout()">
            <mat-icon>exit_to_app</mat-icon>
            <span>–í—ã–π—Ç–∏</span>
          </button>
        </mat-menu>
      </mat-toolbar>
      
      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã -->
      <div id="map" class="map-container"></div>
      
      <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
      <mat-card class="filters-card">
        <div class="filters-header">
          <h3>–§–∏–ª—å—Ç—Ä—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h3>
          <button mat-icon-button (click)="toggleFilters()">
            <mat-icon>{{showFilters ? 'expand_less' : 'expand_more'}}</mat-icon>
          </button>
        </div>
        
        <mat-expansion-panel [expanded]="showFilters">
          <mat-expansion-panel-header>
            <mat-panel-title>
              –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            </mat-panel-title>
          </mat-expansion-panel-header>
          
          <div class="filters-content">
            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>–¢–∏–ø –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</mat-label>
              <mat-select [formControl]="typeFilter" multiple>
                <mat-option value="concert">üéµ –ö–æ–Ω—Ü–µ—Ä—Ç</mat-option>
                <mat-option value="exhibition">üñº –í—ã—Å—Ç–∞–≤–∫–∞</mat-option>
                <mat-option value="meetup">üë• –í—Å—Ç—Ä–µ—á–∞</mat-option>
                <mat-option value="workshop">üîß –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å</mat-option>
                <mat-option value="sport">‚öΩ –°–ø–æ—Ä—Ç</mat-option>
                <mat-option value="festival">üéâ –§–µ—Å—Ç–∏–≤–∞–ª—å</mat-option>
              </mat-select>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>–î–∞—Ç–∞</mat-label>
              <input matInput [matDatepicker]="picker" [formControl]="dateFilter">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="filter-field">
              <mat-label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</mat-label>
              <mat-select [formControl]="sortFilter">
                <mat-option value="date_asc">–ü–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)</mat-option>
                <mat-option value="date_desc">–ü–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ)</mat-option>
                <mat-option value="participants_desc">–ü–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</mat-option>
                <mat-option value="participants_asc">–ü–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)</mat-option>
              </mat-select>
            </mat-form-field>
            
            <mat-checkbox [formControl]="showOnlyAvailableFilter">
              –¢–æ–ª—å–∫–æ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –º–µ—Å—Ç–∞–º–∏
            </mat-checkbox>
            
            <div class="filter-actions">
              <button mat-button color="primary" (click)="applyFilters()">
                <mat-icon>filter_alt</mat-icon>
                –ü—Ä–∏–º–µ–Ω–∏—Ç—å
              </button>
              
              <button mat-button (click)="resetFilters()">
                <mat-icon>clear_all</mat-icon>
                –°–±—Ä–æ—Å–∏—Ç—å
              </button>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-card>
      
      <!-- –¢–∞–±–ª–∏—Ü–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
      <div class="events-table-container" [class.hidden]="!showEventsTable">
        <mat-card class="events-table-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>event</mat-icon>
              –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
              <span class="events-count">({{eventsDataSource.data.length}})</span>
            </mat-card-title>
            <button mat-icon-button (click)="toggleEventsTable()" class="close-table-btn">
              <mat-icon>close</mat-icon>
            </button>
          </mat-card-header>
          
          <mat-card-content>
            <!-- –ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ -->
            <div class="table-search">
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>–ü–æ–∏—Å–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</mat-label>
                <input matInput [formControl]="tableSearchControl" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ...">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>
              
              <button mat-button (click)="refreshEvents()" [disabled]="isLoading">
                <mat-icon>refresh</mat-icon>
                –û–±–Ω–æ–≤–∏—Ç—å
              </button>
            </div>
            
            <!-- –¢–∞–±–ª–∏—Ü–∞ -->
            <div class="table-wrapper">
              <table mat-table [dataSource]="eventsDataSource" matSort class="events-table">
                
                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ Column -->
                <ng-container matColumnDef="title">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="event-title">
                      {{event.title}}
                      <span class="event-type">{{getEventTypeText(event.type)}}</span>
                    </div>
                    <div class="event-location" *ngIf="event.location">
                      <mat-icon class="location-icon">location_on</mat-icon>
                      {{getDistance(event)}}
                    </div>
                  </td>
                </ng-container>
                
                <!-- –î–∞—Ç–∞ Column -->
                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>–î–∞—Ç–∞</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="event-date">
                      {{formatDate(event.event_date)}}
                    </div>
                    <div class="event-time-remaining" [class]="getTimeRemainingClass(event)">
                      {{getTimeRemaining(event)}}
                    </div>
                  </td>
                </ng-container>
                
                <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ Column -->
                <ng-container matColumnDef="participants">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="participants-info">
                      <div class="participants-count">
                        <mat-icon>group</mat-icon>
                        {{event.participants_count || 0}}
                        <span *ngIf="event.max_participants">/{{event.max_participants}}</span>
                      </div>
                      <mat-progress-bar 
                        *ngIf="event.max_participants"
                        mode="determinate" 
                        [value]="(event.participants_count / event.max_participants) * 100"
                        class="participants-progress">
                      </mat-progress-bar>
                      <div *ngIf="isEventFull(event)" class="event-full">
                        –ú–µ—Å—Ç –Ω–µ—Ç
                      </div>
                    </div>
                  </td>
                </ng-container>
                
                <!-- –°—Ç–∞—Ç—É—Å Column -->
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>–°—Ç–∞—Ç—É—Å</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="status-cell">
                      <mat-chip [color]="getEventStatusColor(event)" selected>
                        {{getEventStatusText(event)}}
                      </mat-chip>
                      <div class="verification-status" *ngIf="!event.is_verified">
                        <mat-icon class="verification-icon">pending</mat-icon>
                        –ù–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
                      </div>
                    </div>
                  </td>
                </ng-container>
                
                <!-- –î–µ–π—Å—Ç–≤–∏—è Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>–î–µ–π—Å—Ç–≤–∏—è</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="action-buttons">
                      <button mat-icon-button color="primary" 
                              (click)="viewEventOnMap(event)"
                              matTooltip="–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ">
                        <mat-icon>place</mat-icon>
                      </button>
                      
                      <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏/–æ—Ç–∫–∞–∑–∞ –æ—Ç —É—á–∞—Å—Ç–∏—è -->
                      <ng-container *ngIf="!isEventCreator(event)">
                        <button mat-icon-button 
                                color="primary"
                                *ngIf="!isParticipating(event)"
                                (click)="participateEvent(event)"
                                [disabled]="isEventFull(event) || !event.is_verified"
                                matTooltip="–ó–∞–ø–∏—Å–∞—Ç—å—Å—è">
                          <mat-icon>person_add</mat-icon>
                        </button>
                        
                        <button mat-icon-button 
                                color="warn"
                                *ngIf="isParticipating(event)"
                                (click)="cancelParticipation(event)"
                                matTooltip="–û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç —É—á–∞—Å—Ç–∏—è">
                          <mat-icon>person_remove</mat-icon>
                        </button>
                      </ng-container>
                      
                      <!-- –î–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è -->
                      <ng-container *ngIf="isEventCreator(event)">
                        <button mat-icon-button color="accent" 
                                (click)="editEvent(event)"
                                matTooltip="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                          <mat-icon>edit</mat-icon>
                        </button>
                      </ng-container>
                    </div>
                  </td>
                </ng-container>
                
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                
                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ -->
                <tr *matNoDataRow>
                  <td class="no-data-cell" colspan="5">
                    <div *ngIf="isLoading" class="loading-row">
                      <mat-spinner diameter="30"></mat-spinner>
                      <span>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π...</span>
                    </div>
                    <div *ngIf="!isLoading && eventsDataSource.data.length === 0" class="no-data-message">
                      <mat-icon>event_busy</mat-icon>
                      <p>–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞–º</p>
                      <button mat-button (click)="resetFilters()">
                        –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                      </button>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <mat-paginator [pageSizeOptions]="[5, 10, 20]" 
                          showFirstLastButtons
                          aria-label="Select page of events"
                          class="events-paginator">
            </mat-paginator>
          </mat-card-content>
        </mat-card>
      </div>
    </div>